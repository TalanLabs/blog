<!DOCTYPE html>
<html lang='fr-FR'>
<head><meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>

<title>Talan Labs | Blog</title>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-112601921-3"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'UA-40718882-5');
</script>

<link rel="icon" type="image/png" sizes="96x96" href='/img/favicon.png'>

<link rel="canonical" href="https://blog.talanlabs.com/gefco-integrateur-mise-place-dun-integrateur-de-flux/">

<link rel="stylesheet" href='/css/bootstrap.min.css' type='text/css'/>
<link rel="stylesheet" href='/css/gaia.css' type='text/css'/>
<link rel="stylesheet" href='/css/fontawesome.min.css' type='text/css'/>
<link rel="stylesheet" href='/css/custom.css' type='text/css'/>

<link href='https://fonts.googleapis.com/css?family=Cambo|Lato:400,700' rel='stylesheet' type='text/css'>
</head>
<body>
<div class="content"><nav class="navbar navbar-expand-lg navbar-light fixed-top">
  <div class="container">
    <a class="navbar-brand" href='/'><img src='/img/logo_talanlabs_white_small.png' alt="Logo Talan Labs"/></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarContent">
      <ul class="navbar-nav mr-auto"></ul>
      <ul class="navbar-nav float-right">
        
        <li><a href="/categories" target="_parent">Les Labs</a></li>
        
        <li><a href="/tags" target="_parent">#Tags</a></li>
        
        <li><a href="/authors" target="_parent">Les Auteurs</a></li>
        
        <li><a href="https://talan.com/metiers/labs" target="_parent">Talan Labs</a></li>
        
      </ul>
    </div>
  </div>
</nav>





<div class="section section-header section-header-blog">
    <div class="parallax filter filter-color-black">
        <div class="image" style="background-image: url('/work-in-progress.jpg')"></div>
        <div class="container">
            <div class="content">
                <h1>Gefco : intégrateur - mise en place d&#39;un intégrateur de flux</h1>
            </div>
        </div>
    </div>
</div>

<div class="section">
    <div class="container">
        <div class="row">
            <div class="col">
                <h1>Gefco : intégrateur - mise en place d&#39;un intégrateur de flux</h1>
            </div>
        </div>

        <div class="row">
            <div class="col-md-8">
                <div class="content-blog">

<p>L&rsquo;intégrateur est une application qui se place au niveau du back-office d&rsquo;une solution SI. C&rsquo;est le composant qui permet d&rsquo;échanger avec les autres SI (partenaires, historiques, &hellip;) via l&rsquo;intermédiaire de flux que ce soit sous forme JMS (MQSeries), mails, file system, SMS &hellip; Ces flux peuvent être reçus ou envoyés et une supervision adéquate est de rigueur.</p>

<p>Préambule</p>

<ul>
<li>Contraintes</li>
<li>Cahier des charges</li>
<li>Mise en place</li>
<li>Ecrans</li>
<li>Statistiques</li>
<li>Réception</li>
<li>Emission</li>
<li>Observations</li>
<li>Exploitation</li>
<li>Cahier de tests</li>
<li>Import de cas de tests</li>
<li>Sauvegarde du résultat</li>
<li>Cas de tests : groupes</li>
<li>Variables</li>
<li>Limites techniques</li>
</ul>

<h1 id="préambule">Préambule</h1>

<p>Dans un tel SI, l&rsquo;intégration de ces flux est soumise à des contraintes de performance directement liées à la forte volumétrie et la taille des échanges et doit se faire en asynchrone afin de tirer meilleure partie des ressources matérielles. Cette contrainte sur la volumétrie est renforcée par le type d&rsquo;activité de l&rsquo;entreprise puisqu&rsquo;il est fort probable que la réception et l&rsquo;émission de ces flux se fasse sur un créneau horaire assez spécifique.</p>

<blockquote>
<p>On pourrait concevoir que l&rsquo;essentialité des flux serait reçu en semaine. La répartition sur une journée est elle-même hétérogène et se calque sur les horaires d&rsquo;ouverture (8h-20h par exemple)</p>
</blockquote>

<p>Alors que le client est connecté au serveur d&rsquo;application, l&rsquo;intégrateur fonctionne en mode stand-alone et peut avoir plusieurs instances lancées simultanément (à condition de bien compartimenter les traitements).</p>

<blockquote>
<p>Pour compartimenter, on pourrait par exemple mettre sur une instance tous les traitements pour l&rsquo;envoi de flux, dont les batch d&rsquo;envoi de mail et sur une autre instance ceux de l&rsquo;intégration et donc le recyclage.
On pourrait également traiter certains types de flux sur une instance et le reste sur une autre.
L&rsquo;intégrateur développé par Synaptix permet de faire dialoguer les différentes instances entre elles.</p>
</blockquote>

<h1 id="contraintes">Contraintes</h1>

<h2 id="contraintes-techniques">Contraintes techniques</h2>

<p>Les contraintes techniques sont principalement dues à la volumétrie des échanges mais également à des contraintes d&rsquo;unicité qui peuvent intervenir.</p>

<p>Deux traitements en parallèle peuvent ainsi se bloquer mutuellement s&rsquo;ils modifient les mêmes objets dans un ordre différent, travailler sur des versions obsolètes des objets, créer en doublon des objets censés être uniques &hellip;</p>

<p>Etant donné la volumétrie, il faut pouvoir paramétrer le nombre de traitements en parallèle suivant le type de flux et ce afin de protéger l&rsquo;intégrateur contre toute surcharge. Il ne s&rsquo;agirait pas de noyer l&rsquo;application avec plusieurs milliers de traitements en parallèle.
Pouvoir intervenir sur ces paramètres à chaud, c&rsquo;est-à-dire même une fois l&rsquo;application lancée, est un avantage non négligeable.</p>

<h2 id="contraintes-fonctionnelles">Contraintes fonctionnelles</h2>

<p>Avec toute solution d&rsquo;intégration de flux se pose le problème du recyclage notamment dans le cas où ces flux sont hiérarchisés et dépendent d&rsquo;un autre.</p>

<blockquote>
<p>Dans le cas quasi systématique où un premier flux crée un objet qui doit être modifié par le second, l&rsquo;intégration du second ne peut se faire que si le premier a correctement été intégré. Cela vaut également dans le cas où les deux arrivent à quelques millisecondes d&rsquo;écart, il est fort à parier que le premier n&rsquo;aura pas fini d&rsquo;être intégré étant donné le caractère asynchrone des traitements.</p>
</blockquote>

<p>De plus, le besoin de supervision apparaît rapidement afin de pouvoir contrôler les traitements et ce afin de permettre des actions utilisateur pour débloquer la situation.</p>

<blockquote>
<p>Avec des données référentielles, il arrive qu&rsquo;il manque des données. Ces données doivent alors être rajoutées ou mises à jour via une action utilisateur. Une fois corrigé, l&rsquo;utilisateur doit relancer les traitements bloqués.</p>
</blockquote>

<p>Parfois, l&rsquo;intégration d&rsquo;un flux ne doit pas se faire. C&rsquo;est le cas lorsqu&rsquo;une contrainte d&rsquo;unicité sur un objet doit être respectée et qu&rsquo;un nouveau flux demande à nouveau sa création.</p>

<blockquote>
<p>Le flux &ldquo;doublon&rdquo; doit être archivé ou supprimé sans qu&rsquo;il ait été intégré.</p>
</blockquote>

<h1 id="cahier-des-charges">Cahier des charges</h1>

<p>Suite aux contraintes détectées, il faut proposer une solution qui permet de caractériser des types d&rsquo;erreurs et de les rendre paramétrable afin de modifier le statut du flux en conséquence.</p>

<p>Ces différentes contraintes nous imposent de proposer un système de recyclage et de supervision, dans lequel les erreurs peuvent bénéficier d&rsquo;un type de recyclage afin de savoir que faire du flux.</p>

<p>Le principe proposé retenu est le suivant :</p>

<ul>
<li><p>Chaque traitement se fait dans un thread à part</p>

<ul>
<li>Ces traitements peuvent remonter des erreurs</li>
<li>Si les flux sont des XML, ils peuvent être validés en utilisant un XSD</li>
<li>Les types d&rsquo;erreurs sont paramétrables et entraînent les actions suivantes : alerte, recyclage automatique (délai paramétrable), recyclage manuel, rejeté</li>
<li>Un écran permet de visualiser les messages reçus, de les recycler</li>
<li>Un écran permet de choisir un type de recyclage pour chaque type d&rsquo;erreur</li>
<li>Un écran permet de visualiser des statistiques sur les flux, par jour</li>
<li>Un écran permet de visualiser des statistiques sur les erreurs, par jour</li>
<li>Mise en place d&rsquo;une servlet technique permettant de paramétrer le nombre de traitements en parallèle</li>
<li>Les flux doivent être stockés</li>
<li>Il faut pouvoir intégrer des flux pour effectuer des tests ou des rattrapages</li>
</ul></li>
</ul>

<h1 id="mise-en-place">Mise en place</h1>

<p>L&rsquo;intégrateur mis en place au sein du programme TOSCA à GEFCO sur le projet Plate-forme Service Client intègre un système complet de recyclage et de supervision des différents flux reçus.
La solution retenue pour le stockage des flux a été de mettre à contribution la base de données. Cette solution n&rsquo;est pas optimale mais a pour mérite de faciliter le recyclage et la supervision. Le principal problème est le stockage des flux pour lesquels une compression a été mise en place tardivement.</p>

<p>Les flux ont un état qui permet d&rsquo;indiquer où ils en sont dans leur vie :
<table ></p>

<p><tr >
<td>
Messages en import
</td>
<td >
Messages en export
</td>
</tr></p>

<p><tbody >
<tr ></p>

<p><td align="center" >A intégrer
</td></p>

<p><td align="center" >A émettre
</td>
</tr>
<tr ></p>

<p><td align="center" >En cours de traitement
</td></p>

<p><td align="center" >En cours de traitement
</td>
</tr>
<tr ></p>

<p><td align="center" >A recycler manuellement
</td></p>

<p><td align="center" >A recycler manuellement
</td>
</tr>
<tr ></p>

<p><td align="center" >A recycler automatiquement
</td></p>

<p><td align="center" >A recycler automatiquement
</td>
</tr>
<tr ></p>

<p><td align="center" >Intégré
</td></p>

<p><td align="center" >Envoyé
</td>
</tr>
<tr ></p>

<p><td align="center" >Rejeté
</td></p>

<p><td align="center" >Rejeté
</td>
</tr>
<tr ></p>

<p><td align="center" >Annulé
</td></p>

<p><td align="center" >Annulé
</td>
</tr>
</tbody>
</table>
Deux états supplémentaires ont été rajoutés pour les flux en mode <strong><em>test</em></strong> :</p>

<ul>
<li>Test réussi

<ul>
<li>Test échoué</li>
</ul></li>
</ul>

<p>Lors de l&rsquo;intégration d&rsquo;un flux XML pour lequel le type de flux indique qu&rsquo;il faut effectuer une validation en utilisant un XSD, la première étape est de vérifier sa syntaxe. En cas d&rsquo;erreur, le flux remonte une erreur technique de type XSD_ERROR mais le traitement continue car elle peut-être caractérisée en tant qu&rsquo;<em>Alerte</em>, donc non bloquante pour l&rsquo;intégration.</p>

<h1 id="ecrans">Ecrans</h1>

<p>Ce premier écran présente les différents flux qui n&rsquo;ont pas encore été intégrés : ceux qui viennent d&rsquo;être reçu et ceux qui sont en recyclage.</p>

<p><img src="https://gitlab.talanlabs.com/talanlabs/documentation-interne/uploads/b716275aed6a99e84a6bbf2b94c046d8/en_cours.png" alt="en_cours" /></p>

<p>Une fois intégrés, ils seront transféré dans l&rsquo;écran des messages archivés, quasi identique à celui présenté.</p>

<p>Cet écran présente des statistiques sur le nombre de messages, ici ceux qui ont été archivés.</p>

<p><img src="https://gitlab.talanlabs.com/talanlabs/documentation-interne/uploads/d7dbeba9c39c7c0b26d750f90645afb1/analyse3.png" alt="analyse3" /></p>

<p>Cet écran présente des statistiques sur les erreurs remontées par des traitements d&rsquo;intégration et le mode de recyclage associé (automatique, manuel, rejeté, alerte).</p>

<p><img src="https://gitlab.talanlabs.com/talanlabs/documentation-interne/uploads/b9b55832e97b314d6e459ac70ccc6295/analyse4.png" alt="analyse4" /></p>

<p>Ce dernier écran présente le système de cahier de test avec le cas d&rsquo;un cahier utilisé pour les tests de non régression.</p>

<p><img src="https://gitlab.talanlabs.com/talanlabs/documentation-interne/uploads/a2b3acc76bd2fb1331029ac0e1be432b/test.png" alt="test" /></p>

<p>L&rsquo;édition du contenu d&rsquo;un flux se fait dans une interface conviviale où il est facile de variabiliser des références et de voir la valeur actuelle.</p>

<p><img src="https://gitlab.talanlabs.com/talanlabs/documentation-interne/uploads/b5ca8fd2bbc8490a690fb8317a1ab06c/edit_test.png" alt="edit_test" /></p>

<h1 id="statistiques">Statistiques</h1>

<p>Les statistiques suivantes ont été réalisées sur une semaine complète.
<table ></p>

<p><tr >
<td>
Sens
</td>
<td>
Nombre de flux
</td>
<td>
Proportion
</td>
</tr></p>

<p><tbody >
<tr ></p>

<p><td >Réception
</td></p>

<p><td align="right" >3 828 408
</td></p>

<p><td align="right" >79%
</td>
</tr>
<tr ></p>

<p><td >Emission
</td></p>

<p><td align="right" >1 016 041
</td></p>

<p><td align="right" >21%
</td>
</tr>
</tbody>
</table></p>

<h2 id="réception">Réception</h2>

<p>Malheureusement sur les quatre millions de flux reçus en une semaine, ils ne sont pas répartis équitablement par jour.
Nous observons que 98% d&rsquo;entre eux sont reçus du lundi au vendredi.
De plus, en semaine, 70% des flux sont reçus de 8h à 20h (50% de la journée).</p>

<p>Sur ce créneau, nous recevons donc environ 550 000 flux, soit 45 800 par heure, 763 par minute, 12 par seconde.</p>

<h3 id="recyclage"><em>Recyclage</em></h3>

<p>Ces flux ne s&rsquo;intègrent pas tous dès le premier coup, une bonne partie tombe en recyclage.
Sur un échantillon donné, voici une approximation des proportions observées
<table ></p>

<p><tr >
<td>
Intégration
</td>
<td>
Nombre de flux
</td>
<td>
Proportion
</td>
</tr></p>

<p><tbody >
<tr ></p>

<p><td >Intégré du premier coup
</td></p>

<p><td align="right" >1 413 025
</td></p>

<p><td align="right" >67%
</td>
</tr>
<tr ></p>

<p><td >Avec recyclage
</td></p>

<p><td align="right" >681 646
</td></p>

<p><td align="right" >33%
</td>
</tr>
</tbody>
</table>
Ces 681 646 flux ont été joués au total plus de 8 000 000 de fois. C&rsquo;est le paramétrage des types d&rsquo;erreurs qui va pouvoir directement influer sur le nombre de recyclages.
Les recyclages étant répartis sur la semaine entière, nous pouvons en déduire que nous en traitons 47 500 par heure, soit 793 par minute, c&rsquo;est à dire environ 13 par seconde. Du moins en théorie !
Dans les faits, le recyclage s&rsquo;effectue par des batchs qui ont pour effet de concentrer le recyclage sur une période très réduite.</p>

<h2 id="emission">Emission</h2>

<p>99.7% des flux à émettre le sont en semaine et la plage horaire 8h à 20h représente plus de 80% des envois.
Sur le million de flux à envoyer, 810 000 le seront sur les heures ouvrées, totalisant au total 162 078 par jour, soit 13 506 par heure, 225 par minute, c&rsquo;est-à-dire près de 4 par seconde.</p>

<p>Le recyclage n&rsquo;est que peu utilisé dans les flux à l&rsquo;export, il s&rsquo;agirait principalement d&rsquo;erreurs techniques relevées lors de la confection du flux et nous ayant contraint à ne pas pouvoir l&rsquo;envoyer.</p>

<h2 id="observations">Observations</h2>

<p>Nos calculs nous amènent à penser que nous traitons à l&rsquo;import 25 flux par seconde en semaine de 8h à 20h, recyclage compris, et 4 à l&rsquo;export. Le reste du temps, nous en traitons moins d&rsquo;une quizaine.
En réalité, il est fréquent d&rsquo;observer que pendant une seconde nous traitons plus de 60 flux avec des maximum relevés allant jusqu&rsquo;à 75 flux, ce qui semble être notre capacité maximale.</p>

<h2 id="exploitation">Exploitation</h2>

<p>Il est très intéressant de pouvoir suivre l&rsquo;état de l&rsquo;intégrateur du point de vue technique. A ces fins, une servlet a été mise en place et permet de consulter le nombre de traitements en cours et en attente. Le format de sortie est en JSON.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;TRIP_FILE&#34;</span>,
  <span style="color:#f92672">&#34;available&#34;</span>: <span style="color:#66d9ef">true</span>,
  <span style="color:#f92672">&#34;busy&#34;</span>: <span style="color:#66d9ef">true</span>,
  <span style="color:#f92672">&#34;overloaded&#34;</span>: <span style="color:#66d9ef">false</span>,
  <span style="color:#f92672">&#34;meaning&#34;</span>: <span style="color:#e6db74">&#34;Processing Channel 40/80, fr.gefco.tli.psc.integrator.agent.in.TripFileAgent, 24 running, 0 pending&#34;</span>,
  <span style="color:#f92672">&#34;nbWorking&#34;</span>: <span style="color:#ae81ff">24</span>,
  <span style="color:#f92672">&#34;nbWaiting&#34;</span>: <span style="color:#ae81ff">0</span>
}</code></pre></div>
<blockquote>
<p><strong><em>name</em></strong> est le nom de la file (qui est liée à un agent)
<strong><em>available</em></strong> indique si l&rsquo;agent est actif
<strong><em>busy</em></strong> indique si au moins un thread est lancé sur l&rsquo;agent
<strong><em>overloaded</em></strong> indique si la file est surchargée
<strong><em>meaning</em></strong> est une description
<strong><em>nbWorking</em></strong> indique le maximum de threads en parallèle autorisé
<strong><em>nbWaiting</em></strong> indique le maximum de messages en attente (utile s&rsquo;il y a plusieurs instances de l&rsquo;intégrateur)</p>
</blockquote>

<p>A tout moment il est possible de modifier le nombre de traitements en parallèle en utilisant une servlet.</p>

<blockquote>
<p>Cette opération doit être sécurisée, c&rsquo;est pourquoi cette servlet n&rsquo;est accessible qu&rsquo;en interne et a besoin d&rsquo;un token passé en paramètre pour être prise en compte</p>
</blockquote>

<h1 id="cahier-de-tests">Cahier de tests</h1>

<p>Un système de tests a été développé et est accessible depuis un écran permettant d&rsquo;ajouter, modifier, effacer et jouer des flux. Permettant de jouer des cas de tests complets, il met également en avant les tests de non régression en proposant de sauvegarder le résultat de l&rsquo;intégration (l&rsquo;état du message et les erreurs remontées) afin de pouvoir effectuer un delta lorsqu&rsquo;il sera rejoué.</p>

<p>Les cas de tests sont placés dans un cahier, créé par un utilisateur.</p>

<blockquote>
<p>Afin de proposer une référence permettant ce delta, il est nécessaire de jouer au moins une fois le flux et d&rsquo;indiquer que le résultat obtenu est la référence.</p>
</blockquote>

<p>Une erreur dispose de trois propriétés
<table ></p>

<p><tr >
<td>
Propriété
</td>
<td>
Exemple 1
</td>
<td>
Exemple 2
</td>
</tr></p>

<p><tbody >
<tr ></p>

<p><td >Code
</td></p>

<p><td >_LIEU<em>INCONNU</em>
</td></p>

<p><td >_MARCHANDISE<em>INEXISTANTE</em>
</td>
</tr>
<tr ></p>

<p><td >Attribut
</td></p>

<p><td ><em>VILLE</em>
</td></p>

<p><td ><em>NO</em>
</td>
</tr>
<tr ></p>

<p><td >Valeur
</td></p>

<p><td ><em>Pariss</em>
</td></p>

<p><td ><em>123456</em>
</td>
</tr>
</tbody>
</table>
Le delta effectué est fait en utilisant toutes les propriétés. Si une erreur était attendue et n&rsquo;a pas été remontée ou si une erreur inattendue a été remontée, le cas de test est invalide.</p>

<h2 id="import-de-cas-de-tests">Import de cas de tests</h2>

<p>Il existe plusieurs façons de créer des flux, allant du simple bouton <em>Ajouter</em> au bouton <em>Ajouter dans un cahier de tests</em> depuis un flux reçu en passant par le bouton <em>Charger les dépendances</em>, ce dernier permettant de chercher en base tous les flux qui portent sur le même objet ou qui sont nécessaires afin de pouvoir jouer le flux sélectionné.</p>

<blockquote>
<p>Il est également possible d&rsquo;exporter un ou plusieurs flux d&rsquo;un cahier dans un <em>.zip</em> permettant de les importer dans un autre cahier, sur un autre environnement par exemple.</p>
</blockquote>

<p>Ces méthodes permettent de reproduire très rapidement un cas observé en PROD sur un autre environnement.</p>

<p>Lors de l&rsquo;ajout d&rsquo;un flux ou lors de son édition, et si le type de flux le permet, la validation du XML en utilisant un XSD est faite à la volée, ce qui minimise les risques de se tromper.</p>

<h2 id="sauvegarde-du-résultat">Sauvegarde du résultat</h2>

<p>Pour chaque flux, il est possible d&rsquo;indiquer s&rsquo;il s&rsquo;agit d&rsquo;un test à blanc ou s&rsquo;il faut sauvegarder le résultat en base. Dans le premier cas, l&rsquo;intégralité des modifications effectuées en base par l&rsquo;intégration du flux est rollback. Pour le second cas, il est nécessaire de bénéficier d&rsquo;une autorisation et ce afin de protéger contre toute erreur de manipulation en particulier sur l&rsquo;environnement de production.</p>

<h2 id="cas-de-tests-groupes">Cas de tests : groupes</h2>

<p>Un cas de test complet comporte des flux hiérarchisés. Ainsi, un ensemble de flux qui doit se jouer consécutivement sera placé dans un même groupe. A la fin de l&rsquo;intégration d&rsquo;un flux, le système jouera le suivant du même groupe et ainsi de suite. Si l&rsquo;un des flux est rejeté les suivants ne sont pas joués, le test de non régression (si référence présente) est alors invalide.</p>

<blockquote>
<p>Plusieurs groupes peuvent être joués en même temps. Des flux de deux groupes différents ne doivent pas dépendre l&rsquo;un de l&rsquo;autre.</p>
</blockquote>

<h2 id="variables">Variables</h2>

<p>Lors de l&rsquo;édition du flux, il est possible de faire recours à des variables qui sont paramétrables, et ce par cahier.
On variabilisera alors les identifiants, codes, &hellip; qui sont utilisés par différents flux du groupe.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">	<span style="color:#75715e">&lt;!-- premier flux --&gt;</span>
  #{tripFileNoCas1}
  
  <span style="color:#75715e">&lt;!-- second flux --&gt;</span>
  #{tripFileNoCas1}</code></pre></div>
<p>Lors du test, la variable sera remplacée par sa valeur dans chacun des flux.</p>

<blockquote>
<p>Afin de faciliter les tests, il est possible de variabiliser une chaîne de caractères directement dans l&rsquo;interface d&rsquo;édition d&rsquo;un flux en sélectionnant la chaîne de caractères à remplacer puis via <em>clic-droit, variabiliser</em> ou <em>alt-shift-L</em>. Cette variabilisation se fait dans tous les flux du groupe, c&rsquo;est pourquoi il faut avoir commencé par le regroupement des flux du même cas de test.</p>
</blockquote>

<h3 id="incrémentation">Incrémentation</h3>

<p>Pour les tests de non régression, où les objets sont habituellement sauvegardés en base, il est indispensable de repartir sur de nouveaux jeux de données, d&rsquo;où la possibilité qui est donnée à l&rsquo;utilisateur d&rsquo;incrémenter automatiquement une ou plusieurs variables lors du test. C&rsquo;est directement dans l&rsquo;édition du flux que sela s&rsquo;opère, en utilisant une syntaxe qui indique à quel moment se fait l&rsquo;incrémentation.</p>

<p>Première solution, on part sur un nouveau jeu de données</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">	<span style="color:#75715e">&lt;!-- premier flux --&gt;</span>
  #{++tripFileNoCas1} <span style="color:#75715e">&lt;!-- l&#39;incrémentation se fait avant la lecture de la valeur --&gt;</span>
  <span style="color:#75715e">&lt;!-- second flux --&gt;</span>
  
  #{tripFileNoCas1}</code></pre></div>
<p>Deuxième solution, on prépare le jeu de données suivant</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">	<span style="color:#75715e">&lt;!-- premier flux --&gt;</span>
  #{tripFileNoCas1}
  <span style="color:#75715e">&lt;!-- second flux --&gt;</span>
  
  #{tripFileNoCas1++} <span style="color:#75715e">&lt;!-- l&#39;incrémentation se fait après la lecture de la valeur --&gt;</span></code></pre></div>
<p>Nous préférerons la première solution puisqu&rsquo;elle permet, en cas d&rsquo;erreur d&rsquo;intégration sur l&rsquo;un des flux, de pouvoir recommencer sur un nouveau jeu de données.</p>

<blockquote>
<p><strong><em>N.B.</em></strong> Les dates sont elles-aussi incrémentables en utilisant une syntaxe un peu plus complexe.
Exemple : <code>${++(1w1d;yyyy-MM-dd'T'HH:mm:ss'Z')variable}</code> indiquant qu&rsquo;on souhaite afficher la date sous tel format et que l&rsquo;incrémentation se fait d&rsquo;une semaine et un jour.</p>
</blockquote>

<h1 id="limites-techniques">Limites techniques</h1>

<p>A GEFCO, nous avons rencontré plusieurs limites techniques.</p>

<p>Sur un environnement UNIX, le nombre de traitements qui peuvent être lancés simultanément sur une machine est limité par un paramètre (cf <em>ulimit -a</em>, <em>max user processes</em>). Par défaut configurée à 1024, il ne faut pas oublier de l&rsquo;augmenter lorsque l&rsquo;intégrateur monte en charge.</p>

<p>Une autre limite rencontrée a été au niveau de l&rsquo;espace mémoire HEAP Space, actuellement fixée à 4 096Mo. Lors de tout développement, il faut penser à garder le moins longtemps possible les gros objets sinon lors d&rsquo;une surcharge ou d&rsquo;un retard accumulé, l&rsquo;espace mémoire pourra saturer.</p>

<p>Un certain nombre de traitements ont besoin d&rsquo;être synchronisés. Synchroniser un traitement destiné à être asynchrone pour des raisons de performances est à proscrire, on risque de figer tout le traitement. Dans ce genre de cas, il ne faut pas hésiter à retarder un traitement en le remettant dans la file d&rsquo;attente et donc en jouer un autre plutôt que le faire attendre avec un verrou et par la même occasion accumuler le retard sur les autres traitements.</p>

<p>Lors de la sauvegarde des objets en base, une vérification de leur version est effectuée. Si la version a été changée, une erreur est remontée et le traitement doit recommencer après un certain délai (recyclage automatique).</p>

<p>Afin d&rsquo;éviter les blocages en base de données, les objets ne sont sauvegardés qu&rsquo;à la fin des traitements pour être le plus proche possible de leur commit en base.
Attention, cette décision aura pour effet d&rsquo;augmenter le nombre d&rsquo;objets pour lesquels la version est obsolète (cf point précédent).</p>

<p>Des inter-blocages entre la partie Java et la partie BDD sont apparus lorsqu&rsquo;un verrou Java et un verrou BDD étaient sollicités en même temps. Avant de rentrer dans un bloc synchronisé, la partie Java avait mis à jour une ligne en BDD sans commiter, et attend de pouvoir dans le bloc, sauf que le verrou Java est déjà utilisé par un traitement qui a besoin de mettre à jour la même ligne.
Côté bonnes pratiques, il vaut mieux éviter l&rsquo;utilisation de verrous Java en simultané avec Oracle Database et laisser à Oracle la gestion des verrous.</p>

<p>Le stockage des flux sur la base de données se fait dans un BLOB, difficilement optimisé pour des traitements par Oracle Database. La compression des flux a permis d’accélérer la récupération et le stockage de ces flux dans la base.</p>
<div class="separator separator-danger"><img src='/img/talan_star_small.png'
                                                                 alt="Etoile Talan"/></div>
                </div>
            </div>

            <div class="col-md-3 col-md-offset-1 text-center right-column">
                <h3 class="social-title"><i class="fas fa-calendar-alt"></i> Date</h3>
                <time class="f6 mv4 dib tracked" datetime='2015-06-08T08:30:00Z'>
                    Publié le 8 juin 2015
                </time>

                <h3 class="social-title"><i class="fas fa-pen"></i> Auteur</h3>
                <div class="author">
    <div class="avatar avatar-danger">
        
        <img alt="Avatar Nicolas POSTE" src='/img/nicolas_poste.jpg'>
        
    </div>
    <div class="description text-center">
        <h3 class="big-text">
            
            Nicolas POSTE
            
        </h3>
        <p class="small-text">Tech Lead</p>
    </div>
    <div class="social-buttons">
        
        
        <a href="https://www.linkedin.com/in/nicolas-poste" target="_blank" class="btn btn-social btn-simple"><i class="fab fa-linkedin"></i></a>
        
        
    </div>
</div>


                <h3 class="social-title"><i class="fas fa-flask"></i> Lab</h3>
                <div class="article-tags">
    
    <a class="badge badge-light" href='/categories/lab-9'>Lab 9</a></div>


                <h3 class="social-title"><i class="fas fa-hashtag"></i> Tags</h3>
                <div class="article-tags">
    
    <a class="badge badge-light" href='/tags/performances-it'>#Performances IT</a></div>


            </div>
        </div>
    </div>
</div>

<div class="section">
    <div class="container">
        <h3 class="social-title"><i class="fas fa-comments"></i> Commentaires</h3>
        <div class="row">
            <div class="col-md-8">
                <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "labs-blog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
        </div>
    </div>
</div>




<div class="section">
    <div class="container">
        <h3 class="social-title"><i class="fas fa-forward"></i> Vous aimerez peut-être...</h3>
        <div class="card-deck">
        
            <a href="/javascript-service-de-lentreprise/" class="card text-center">
    
    
    
    <div class="ribbon red"><span>Lab 9</span></div>
    
    

    
    

    <div class="card-header">
        <h2 class="card-title">JavaScript au service de l’entreprise</h2>
        <span class="card-subtitle mb-2 text-muted">
            <strong>Sallah Kokaina</strong>,
            <time class="post-date" datetime='2015-06-05T09:57:30Z'>
                le 5 juin 2015
            </time>
        </span>
    </div>

    <div class="card-body">
        <p class="card-text">Introduction JavaScript fut, depuis sa création par Brendan Eich en 1995 jusqu&rsquo;à l’arrivée du moteur JavaScript V8, considéré comme un langage de programmation limité au …</p>
    </div>

    <div class="card-footer">
        <div class="article-tags tags-margin">
    
    <span class="badge badge-light">Agile</span>
    <span class="badge badge-light">Angular</span>
    <span class="badge badge-light">Javascript</span>
    <span class="badge badge-light">Scrum</span></div>

        <div class="btn offer-link"><strong>Lire la suite</strong> <i class="fas fa-chevron-right"></i></div>
    </div>
</a>

        
            <a href="/gefco-tableau-de-bord/" class="card text-center">
    
    
    
    <div class="ribbon red"><span>Lab 9</span></div>
    
    

    
    

    <div class="card-header">
        <h2 class="card-title">Gefco : Tableau de bord</h2>
        <span class="card-subtitle mb-2 text-muted">
            <strong>La Rédaction</strong>,
            <time class="post-date" datetime='2015-06-03T14:48:21Z'>
                le 3 juin 2015
            </time>
        </span>
    </div>

    <div class="card-body">
        <p class="card-text">Gefco a fait appel à Cereza et Talan Labs pour le développement de leur plateforme service client et la création de tableau de bord client temps réel.</p>
    </div>

    <div class="card-footer">
        <div class="article-tags tags-margin">
    
    <span class="badge badge-light">oracle</span></div>

        <div class="btn offer-link"><strong>Lire la suite</strong> <i class="fas fa-chevron-right"></i></div>
    </div>
</a>

        
        </div>
        
    </div>
</div>

</div><footer class="footer footer-big footer-blue">
    <div class="container">
        <div class="row">
            <div class="col-md-4 col-sm-4">
                <div class="info">
                    <h5 class="title">Les Labs de Talan</h5>
                    <nav>
                        <ul>
                            <li><a href='/categories/lab-0'><i class="fas fa-flask"></i> Lab Agilité</a></li>
                            <li><a href='/categories/lab-k'><i class="fas fa-flask"></i> Lab Blockchain</a></li>
                            <li><a href='/categories/lab-v'><i class="fas fa-flask"></i> Lab DevOps</a></li>
                            <li><a href='/categories/lab-9'><i class="fas fa-flask"></i> Lab Bootcamp</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="col-md-4 col-sm-4">
                <div class="info">
                    <h5 class="title">Talan Labs</h5>
                    <nav>
                        <ul>
                            <li><a href="https://twitter.com/TalanLabs" target="_blank"><i class="fab fa-twitter"></i> Twitter</a></li>
                            <li><a href="https://www.linkedin.com/company/talanlabs/" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a></li>
                            <li><a href="https://talan.com/metiers/labs/" target="_blank"><i class="fas fa-link"></i> Site web</a></li>
                            <li><a href="https://www.welcometothejungle.co/fr/companies/talanlabs/" target="_blank"><i class="fas fa-briefcase"></i> Welcome to the Jungle</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
            <div class="col-md-4 col-sm-4">
                <div class="info">
                    <h5 class="title">Le groupe Talan</h5>
                    <nav>
                        <ul>
                            <li><a href="https://twitter.com/talan_fr" target="_blank"><i class="fab fa-twitter"></i> Twitter</a></li>
                            <li><a href="https://www.linkedin.com/company/talan/" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a></li>
                            <li><a href="https://www.facebook.com/talan/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a></li>
                            <li><a href="https://talan.com/" target="_blank"><i class="fas fa-link"></i> Site web</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
        <hr>
        <div class="copyright">© 2019 - Le Blog des Labs de Talan</div>
    </div>
</footer>
</body>


<script type="text/javascript" src='/js/jquery.min.js'></script>
<script type="text/javascript" src='/js/bootstrap.min.js'></script>


<script type="text/javascript" src='/js/modernizr.js'></script>

<script type="text/javascript" src='/js/fontawesome.min.js'></script>


<script type="text/javascript" src='/js/gaia.js'></script>

<script type="text/javascript" src='/js/custom.js'></script>
</html>
